using System.Collections;
using System.Text;

namespace Aoc2021
{
    static class Day20
    {

        //static
        static string input = @"..#.#..#####.#.#.#.###.##.....###.##.#..###.####..#####..#....#..#..##..###..######.###...####..#..#####..##..#.#####...##.#.#..#.##..#.#......#.###.######.###.####...#.##.##..#..#..#####.....#.#....###..#.##......#.....#..#..#..##..#...##.######.####.####.#.#...#.......#..#.#.#...####.##.#......#..#...##.#.##..#...##.#.##..###.#......#.#.......#.#.#.####.###.##...#.....####.#..#..#.##.#....##..#.####....##...##..#...#......#.#.......#.......##..####..#...#.#.#...##..#.#..###..#####........#..####......#..#

#..#.
#....
##..#
..#..
..###";
        static string input2 = @"#.#.#.#.#......#.#.#.#.##..#.##.##..#..##...#.#.#.#...##.##.##.###....#..#...#.#..###.#...#..##.#.###..#..####.###...#.#.#..##..##.##..##..###..#....#.#....#####.#...###...#.#....###...#..##.##..#..#.##..###..#.##.###..#.####...#.##.....#.###...#.##.##.#.#######...#.###..##..##..#.#.#.#####...#....#.....##.#.#...##.######....#..#......#.#.#.#.##...######.#.#####..#####..#.#.#.#.###.#.#....#..##..#..#.#.#..##....##..#.#.......##...#..####.####.#.#..#.###..#...#......###...#...#.##.#.####..#.#....###.####..#.

.#.#.########.##.#...##.####...##..#####...##..#.#.###..#...#.#.##.#.....#..#.###...##..#.###.###.##
.######.#..##.##...#.#.####.#.###..#..#.##.##...##.#...##..#.######...##....###...###..#.#.##.##....
..######.#.#.##.#.##.###.##..#####.####..#......#.##.###.#.#.##...#####.###..###...#..#..#..##.#....
###..##.#...##.#.#...######..#.#..##..##.#.##.#.#.#.##.#..####.#.#.##......#.#.#...#.##..#.###.###.#
#.#.#...#..####...#.#..#.##.####.#..#..###########...#....#.#.##.###..#####.#.#.#.###...##..####.#..
#.#..#.##.#..#..#..#....##.#.#.#...#..###.#.##.##.#.#.##.##..#.#.####.#######....###..#.######.#.#..
......###..#..##.####.##.##..#..#.##.##.#..#...###...####.#..#...###.##.#.#####.....#...#..#...####.
####..##.###.#...##..#.##....#..##.##..####.#.#.####.##..#..#.....#.###......#.#....#.#.....#.#..#..
.###.####.#..###..#.#.#.#...##.####.#..#..##....#...###.#.#....#..#######.###.....#.#.#.##...##.#..#
##.#......#.##.###.#.##..##.##..#######.###..##..#.#####..#.#..#.#.#..#..##..##.##...#####.#.##.####
.#.###....##.......#######..#.########..#..##..#.####.###..#..###.##..#...####.#.#..#.##.######.#..#
..###.#.##..##.#....#..#.####.....#.#..#..##.##.###..#.###.....##..#.##..#..#.#...#...#.#########.##
..#.#.#.#..#...#.##.#.##.#..#...##.#..........#.###.##.##....#####...#.#####.###.#......#..#.#.#..##
#....#..#.#.#.####.#####.#.#.####.###......#.....#.#..######....##....#.##..##.##...#.#####.##..##.#
#.#....#####....###.###.#.#...#.##.#..........#....##.#..##..##.####.##.#.##....##..#.#.##..##.#.###
..####...####..##.#.....#........#.#..##..#.#..###.....####...#...#.###....#....##.#..##.#.##....##.
...#.###........####...#...##..#..##.#.######...#...#.#.#...###....##..##.#..##.......###.##.###...#
##.#####...#.#.##.##.#...#.....#.##.########.....#.##..#.####.##...#......####..#.#..#..#...#.......
.....###..##.###.#.#.#.....##.#.####...#..######.##....#.##.#.#.#...##.####.####.##....##.#.#.###..#
.########..#.#.#.##..#..#..#.#..#..#.#.##.###.###.#...#.#..#####..##.###.#.##..###.###.#.#.####...##
###..##.##...#...#.....####.#.#......##.####..#......##..#####.#.....#.###.##.....#.##...#...#...###
#.#.#.....##.##..#..#.###.#..##..##..#....#...##.....##..##.####.#######.....#........###..#.##.#.##
.#....##..###.#..###.#...###.#...###...#.#..####..######......##.##.##..#...#..#####.####...##..#...
####.#..#.##....#.#.#...#.#.#####.###.#..##.#.###.....#..#.##......#.##...##..##...##..####.#...##..
....#.####..#..##.####.#######...#..#########.##.##..#..#.##.##.#.###.##.#.#....#####.###...#.####.#
..#.....##...###..#.##...#.#...###...#######.##..####.##.##..##.#########..###........##....#..#..#.
.#.##.#.#.##.....##.#.##..###.###.#.....###...###..#.#.#####.##.#....##.#.##.##.##.#.#....#........#
.#.#..#.#............#....###.#...####..####....#..#.##..#.##..#####...###.######...##..#####..###..
###.#..##.#...##..#.#..#..##.#..#..#..#..#####......##.##..#####..#......#..#####.##.####......##.##
##...#...##.#####..#...#.#.....#.#..###.#..#.####.....#.....#.#.#.#.###.####..#.......##.#....#..##.
#...#.#..#####..###.........#.####.###..#....###...#......#...#.#..#.....#####..#.###...#.#...#.....
###....#..##.##.####.###.#.#.##.#.#....##..#....##..#.#.###..######.#.#.#..####.##...####..##..##.##
.###...##.#.#####.#...#.###..##..###....#.##....#...#.#..#...##.###...#.#.#.#######......###.###.#.#
.#.#.#.....#..##..#.##.#..#.....#.#.######..#.##.#....###.#....#...#####..#.######.###....###...####
####..#....########...#..##..#####.#...#.##..##..###...###.#####....##.#.#..#.###.#.#..#.#.#..#.###.
.##.##.##.#####...#..#..#.###.#.#..###.#......###.##.#.###..#####.#.#...#.###.#.#.###.##.#...#.##.#.
#.#.##....#####...##.#.##.######.#.#.##.###.#.......###......##..###.#.###...##..##.#.#...#..##.####
##.#....#.##.#..#...#.#...#.##......####.#.#..#..###.#####.#...##.####...#..###.##.#.##..###.####.#.
#.#..#.#.##...##.....###.#.#.#..##.###.#######........###..#.....####.#.##.##...####.##.#.##.###.###
##...#.####..#...#...##.#.##..#.##.###..#.##..##......#..#.#...######..#....#.######..######..####..
.....#.#.......####.....#..#.####.#...##..##...#....#.########.#.#.##..##.##..####..##.####..#.#.###
.#..#.#....#..##..#....##...###........#.#..#.##.####....###..#..##...#..##.#.#.###.#.#.#..#.####...
#.#...###.#....#...##############...###..##...#.#.##..#..#....#...####....##..###.##..##..##.#..##.#
##..#....#...#..#..##.#..###....#.#.#.###.#.#.###..###..####.###.#.#.###.#..###.#.###.#.##...#.#####
#..#..####.....###..#.#...##.######..####..#..#....#####...#...#..#..#.....#.##.####......#..##.###.
##.##..###.###.#..###...#.####...#....#........#..#..##..##..##.#.##....#.......#.###...#..###.#....
#.##.#.#..#..###..###...#...#.###..####.#.#....#.#.......##...#..#......##....##.#####.......#...#..
....#..#..##.##.#.##.#.##..#.##..##.##.##.##..##.######.##..##.....#.###..#...#.##.#.#.####.###.###.
.###....##.##..##..#.###..##.#..#.#.##..##.###..##.###..#......########.#####....##...#...##...##.##
.###.###.#.#######.......#.#.#.##.##..#.#.#.##..#.##...##.##.#...##.#.#######.#..#..##..#.#..##.##.#
....#.###.#.##...##..#...#...#..##...#.##...##.##.##.#.#####.....#.#.#.##..####.####.#..####..#..##.
##..#.##.#######.#.#...###.#....###.###..##.###.##.##.#.#..##.....#.##......##.###..##.#.#.##..##...
...#####.#.##.#..##....##.###.##.#..##..###......#.#..####.##...##.#.###...##.....#..#..###..#####..
.#####.#.#..#....####.#####.#..##..#.#####.##..#.#.#..##...#.#..######.###..##....###.#....###...#.#
..###......##.##.#.##..#..##.....##....##.##..##.....###.#..##.#.#######..#...####..#.###.#####.###.
##..#.######.####..#.#..###.#..#.#..#######.#...#...##.#.###.#.##..##.#......##.#.#..##.#.#.#.####..
..#.#.####.##..##.#.#.#..####.#.##...###..#.##..#.##.###..####......#..#..#####.#..#.#####.#.###.###
#..#.#.....#.#...#..###.####..##..#....##.#.###..##..#.#..#.####...##..##..#..####...#########....##
.#.....#......##.#..#.####.######..#.#.#.#.##...#..#..#...#.###..#....#..#.#...#####..###.##...#.##.
.####....#.###..#..###.#...#..###.#.#..#......###.##.#.#.#.#####..#######..####.##.....#....#..##.#.
...#.##.#.#..####.#####..##..#.##.###.#####..###...##...##.##..#.####..##.#...####...#..##......###.
###...##.....#.###...##.#..#.#......##..#...##.#..##.#.#..#.###..#..#####..#.###..#.#...#..##.#.#.#.
##.##.##.#.#.#.####.##..##....#.####.####.####...##.####.#....###....###.###.#..#.####.#...####.#.#.
####.###...####.#.##...#...##..##...##....#.#.####..#..#.....#.....##....###.....###...#...##.#.###.
######..#..#####...#..#..######.##...#.###.#....####..####.##.#.#..#.#.####.##.####..##...####.##.#.
##....#.#...#..###..#.##.#.#...###..####.....#.##.#.####..#.##....##...##########..##...###.#.###.##
..#.#######....#####..##.####.##.#####..###.#.#..####.....###########...##.#....#.#..##.##.###..###.
##.....##...#..#....#####...#...#..#.#.#.#.####....##...####.#.#.#.....#.#..........#.###..##.#.#.#.
.#####...#..#.##..##.#...#.#.##..###..#.#....#...#.#.#..#.#..#..#.###.#...######.#.####..##..##.#...
..#.#.#.##..#.##..#.###......###..#....##.###.#..###.#...##.#.#.....#.##....##.##.##.#...####.####.#
##..#.##.##.##.#....##.#..#..#.##.###..##.##.#.#.#......####..##.#.#.###.....##.....#.##..####..##.#
.###.#.##.#..##.##.#.###.#.##.##.#####...#.#..#..#..#..#.####..#.######..#.#.#...#..#####...#.#..##.
..#...#.####.####.####...#..#..##..#.##.#.#..#..####..#...#.####.#.###.##..#......#..#...#..#..###..
.#..#.###.......#..##.#.#..##..#.#..#..##..#.....####.###...#..#.###.##.#..#.#..##..#...##.##.##....
#....##..#...##.###.#......##..###...##.###..##..###.####.....#...###..#.#...#####.#.#.######..#..#.
##.###.....#...#.#..##.#.#..#.#....#...#..##.######.###.#.####.#.######...#.#.#....##.##..#...#...#.
.......#..#.##..#..##...#.##.#####..###.####.###.#.#..###....#.#........#..#.#.#.......####..#......
#####...##.######....#.#.##.#..##...#..#..#..#...#..##.###....#.#.......##...#.###.###..####.##.###.
.###.##.#....#.#..#..#..##....##...##.#...##....#......#####...####.######.#.#.##.##..##.#.#.....#..
..#.##..#.####..####.##.#...#..####..##.....###.#...###..#.###.######.#.#.##..#.#.#####.#.##.#.##...
.##.###########.#..####.#.####..#.####.##########..#.##.#.#.#..#.#..#.#####.....##.#...#.###..#.##..
...###.#.#..#.#.#.#....#..##..####.##...###.#....#.#.####.#.#..#..####...####..###.##..######.##....
#..#####.#######.#.###......#..#.#.##.##.###.#.##.#...#....#.#####..###..##.#.#####.#..#..#.###.#..#
#.####..#..#.......###..#..####.#.#.#..#.#..#..#.#...#####.#.......####.#.#.##.##.#..#..##.#....##.#
###.###...#..#..##.#..#.#..#..#####.#.#####.....#..#..####....##.##.....#.....#.###.#.#.#.##.#.####.
.#.##.#.#..#.#####.#.##.#.###.#...#..#..#.#...##.#.##......#.#.#####..#......###.########.#..#.###.#
#.##.....#.####..######..##..#...#.....##..##..#.#.##.###.#.#.#.#.....#...#.#..###..##..##.######.##
####......#.##..#.##..##.##..#.##.....#####...#.#...###.#..##..###.##.###..............##.#.#....#.#
###...##.##.##.####....####..#...##...#.####.#....#.....#####.....##...##..###.#...##.#...##.##.##..
#.#.####...###.....###.###.##.###.....##.##.....###..###..##......##..####.#..##.#.##....##.#.#..#.#
####...###.#####.#####.......##..##.###..#..##.##..#..###.#..#..###.....##..##..##.##.#..####.#.#.#.
######....#.##.##.#.###...##...###.###.#.##.###....##.#......#.##.##.#####...#..##....###...#..##...
..#...........##..........#.##.#.##.##.###...##..##.#####.#####.#...##..####.....#.##....#..#.###.##
.#..##.#...#.#####...##.#.#.###.#.#..##..#..##########..#.#...#...#...##.##.#...##..#.#.#.##.#..#..#
..##....##.#..#...#.#...#.#....#..#.#.#####.##.#......#...##..######..##....####..##.##.##.###.###..
#.......#..############...##....##...#.#....#...##..###..##....####..##....#...##.###...#..#...#####
..##..##..#.###.#.##.#.####.#.##...#.#..#.#####...######...######.####...###.#.#.##..#.######..#.#..
###.#....#####..#.##.##..###..##.#..#.#.#.##.#......#..#....##.#.#.###..#.#######.###..#..#..#.###..
#...#.#..#.####.###..##.#.#####...#.#.##..#..#.#####.#.###.##.####..#..##.#.##...##...####.#..#.###.
...#.##.##...#.#...####....#..#####...#.#.....####.##.######.#.#...#...###.##..##.#.#.#..#...###.#..";
static string input3 = @"####....#.....##.####..#.##.###.########.##.#..#.##.#...#..##.######..#......#..###.#.##.####.#.#.#....######.###...###.#.###.####..###.......#..#.#.#.#.#.####..####.#..####.#..####..##.#.#.#.###..##..#....#...###.#....###....##.###...##..#..#..#...##...#.#..#..###...####.#.#.###..#.#.#..###.##.##.#..###...#.#.#.##...#...#..#...##..###..###..#...###.#....#.##.#.####...##...##.#.####.#####.##...#######.###..##.#####.##.....####.#######.#.#.##....#...##...#..##.###.######.#######.#.#.#....#..##.###.#..##..##.

###..#..........#.#.###.###.#.#..###.#.###.###.#....#.#.....###.#...#####.####...####.#..####....##.
#..####.##.##..###..#.#...#.######.#.#.#.......######......#...###.####...#..#..#.#.###.#.##.#..#..#
#..#####.....###....#..##..#...##...#.####..##...#..##.#.#...#.#.......#...#.#....##.##.#..#..#.###.
.#.#..#..##.##.#.##..##....###...#..#.#.#..##..#.####...#..##...###.#.#.#..#.#..##..##.#.##......###
##.#.###...#.#.#.#..#.....##.....##.#.#.#.###..#.#...####..###.##...#..#.##....##....#...#..#.###..#
###..#.#.#.....#....#.##.####..###.#####..#..########.##.#.#..#...#####..####.#...#..###..###...#..#
#.#.##..###..##.##.#.#..###.##...#..#..#..#...#..#.#.###...#..##.##.##..###.#.#.#..#....#....####.#.
#.###.#..##..#.###.#####.#..#.###..##...#..#.#.###...##.#...###...#...#...##..#...##.#..##.##.###...
.#.###..#.#.#.####.#.##...#....#....#.#.##....##.#####.#....#....#####..#.#......###....###..##....#
.##.......#...#.#.#....#....#..#..#.###.#.#.##########.##..#####..#.#.##...#..#.###.#...#.#....#####
..#..#.###.#.#.####..###.####.#.###.#..#..#.#...#..#.#..####.#.#####.#..#...##.#.#.###.##.####......
.##..#..#####...#..#.#..#.......#.#.#.#..####.##..#..##.##...#...######..####...#....#....##.#.#.##.
...#.##.#..##..#.##.##.##.#.#.....#.....#..#.#.#..#...####.#####.##.###.#..####..####..#.##....###.#
.##.##......##.#..#....#######..##.####.#...######....######.##.#.##..#..#.#..##..##.#.#####.#.....#
###..#####.#..#...#.##...###...##.#.##..##.##.####.###..#.##.#.##.###....#..#.##.###..##.##.##..##.#
.#.#.##.#.......#.#..#...#.######..#..##.##.##.###.##.###.#.#.#...#..##.##.###..#..#..#..##..#.#.#..
##..###..#...##.#....##....#...##.#.#####.#..#.###.#..#..#####.##.#######.####.##.#..##.##..#.####.#
.#..###.##...#.#.###.#.#.##.##.#.#...#..#.###..#.#.#####..#..###...#.#..#.###......###.#.#...##.##.#
...#.#..#...###...#..#####.##..####..###.###.#....#....#...#.###.#..##.#.#.##...#.###..###..##.##.#.
##..#.#.###.#####...#####..#.###..##.#.#.#...##.#####.####.....#.###...##.####.#...#....#..#..###.##
#.....#.#.##.###...#..######.#.#.#######.#..#.##.#.#...#..###.###.#..........####..#..#...#######...
.##..##.#..#.#...##.###.....##.#..#...#..##.#.....#.#.#.##.###.#######..###.....#.###..#....##.#.#..
.##.#.##.....#...#...#.#.#..#......##.#.##.#..#....#....#####.######..#......####...#.###.##.##..##.
.#.####....###...#..##.#####.#....##.#.##..#.#.#.#.##.#.#......###.#..###.###.....#.#.###...#.##.#..
..#.....##...##...#.#..##...#.....#..#.#.####.#......#.###...#.#.#..##.##.##.##.#....##..###.#.#.#.#
#.###..#...#..#.#.....##.####.#......#####...#####.##.#######..####.......##.###....#.###....##..#..
##.#.#..........#....###...##.###.##.#.#....##..#....#.##.##..####...##...##.##..#.#.#######..###.##
.###.##.#..###############.#.#..#..##..#.#####.##.#..##.#......#.##...####.......#####..########.#.#
......#..#..#.#####.#..#.#.##.##..###.###..####.##...#.#.....####..#..#..#..##...#.#..#.###.#..##...
#....###...##.###..###..#.##.....#.#....##..###..###.##..##..#.##..###.##.##.#..#.....##.#.#.##.....
.#.###.###..#.##..#...##..##..##....#..#..#..####.##..##..##....#.##..#.#...#....###.##..#.#..#.#.##
.#.#.###.#..###.#..#.#.#.##..#.#...#####.#.#.########.###...####.##.....#...#..#..####..#.########..
..##.##.#.##.##.##..##.#..#.##.##.##.########.####...##.#.##.#####...###..#....##....##..#..####...#
..##.###.......##......##.#####.####.###.#.#.#.#.#.#.##.###.#...#.#..##..#....#......#.#..#....#.#..
######..#..######..##.##.#..#..##...#.#.##.##.#.####.##..##..#.###.#...##..#..#.#........##.##.##...
.#..##...#.#..##.#.....######..#.#######..#.#..#.##.##.#.####.#..##.#..#...#..##...#.#.###.######.##
......#....##.####....#.####..#..#...####...#.##..##....##....##.#.#.##.########..#....#.###.#...#.#
.......#.....#.#.##..#....##.###.#..##.#.#...#..#......#.#..#......#...#....#..#.##....###.##.###...
#..#.##.#...#.##..######..#.##...###..#...#..####.#......#..#.#..##.#.####.#...##.#...#.#.#..##.#.#.
#...##.#...#.##..#.##..#..#.#.#..#.##...######..#..#..#..#..#...###..##.###.#.#...#..####.####...#.#
####.#....###.#..##.#.#..#...#..##.##.##...##.#########..#.......#######...#.#.####.#...#...##....##
.##..#.#..#.#.#..#.###.##.##.#.#.#####.......#####.......#.#.##.##..##......#.#####..###......#..###
...##..#.#.##..#######.#..#..#.....#..#.########..###.###.#.##.#..###...#..#....##.#.#####.##.##.#.#
##....#...#.###.#...#....###.#.#...###.....##.##.#...#.##..##.##.##.##....##.##.##.##.####.......#.#
##.####.###..####..#...###..####.##.##.#######.#..####.##.######.#...#.####.##.##.#....#.##..#.#.##.
..##..######.#.#.##..#..#####..#.#..#......###..######.##....#........#.##.#.##.##.#.....###...#.#.#
#.#...#..##.#..##.#.#..#..######.#....#..##.#....###..##.#.#.#.#.#..###.###.###..##...#.......##.#.#
#.#.#.#####.##...####.##.##.##...#..##.##.##.###.#...##...#.##..##..#.#...##..#....##..#......#####.
##.##.....#.#.#...####.#...#####.##...#.....#..#..#.#.#.#..#....#.#.##....##.##....##.##.#.#......##
#.#.##..#.#..#.....#..#.#..###.#..#####....####..######..#..##.#.#.#..##..####.....#######...#.#.##.
##...###.....##...#.#.##.####..#...###.#..######.....######....##..####..#####..##.###......#..##..#
##.#.###.#.##.####.###.##..##........#..#####.....#.###.#.#....##.#.###.#...#.#..#.........##.#.##..
....#.####...#.#........###..#.###.###..####..####...#.##...###########.#.##.###..#..####.#..#.##.##
.#####....##.#.#..#..#.##...##......##.#.#....######.......###.#.#.##.#.....#...#.#.....#.###...###.
##..#..####..###.###...#...#.##.#.#..##.#.##.##.##....#.#.#...#...#..#.#.###....#..##.......##.#.#..
##.#.#.##.#.#.######..###..#..####.........##.#..##########.###..#.#..#...##.##...#####.....#.#..#.#
##.#..#..#.#.##...######.#...##..###..##..##.#..####..#..##.#....##.#........#####.###...###.##...#.
....#.#.##...##...##..####.#####.#.#####.#..#.########....##.....###.#.##.#..####.##.#.....###.#.#..
#####.#.#.###.#####.##...###.####..##.##..##.##.##.#.###.####..##...#.##.#..##...######...#.....##.#
#..##.#.###.###....#..###..........#.##.#..#.#.####..#.####..###......##.....#.###....###.#.....#.##
.######...#####.###..##.#......###...###..#.#.#.###..#.###.....#.#...##..#..##.##.##..#......#.####.
#..##..#...##.##...###......#..#.###..###..##....##...##.##.#...####.####..##...##.#..#....##.#.#.#.
#.##..##.......#.#.##.##.#....###....#.###.##.#....#.#..####....###.##.#.##...#..#.##...#......#.#..
..#..#...#.....#.##.#.####......#....#.##...###.#...##.#..#..#......#...##.###.###..#.##.####...#...
#..##.##.#.##..####.#.##...#.#.#.#.##.#.##....#.#.#...#.####...####.#.##......###..#..##.##...#..#.#
...#..#.#.#...#....####.#.##....###.#..#.####.##..#.##.##...#.#.##.#.#.....#.....###.###..###.#####.
..#.####.....#..##.##..#...##..#...##....#.#####.#..#...#..#..#..#####.#.##.#.....#.###..###..#...##
#.##...#.##...#..#.......#.....###...##.#..#.......#...#.#..####...#...#..##....####..#..###.#..#...
......##...#..#..####..##.#.#...#.#...###....###.##..#.#.##.#.##.##.#.#.#####.##.####.###.#.#.###...
#.#.#.#..#...#...#....##.######....###.#..#..#.#..##..##.###...#..#.##...###..####...###...##.######
.####..###.#.#...#.#.#.#..###....##.###.##.....#.#.####...#.##..###.#.####.##.###..###.##..#.....#.#
.......#..##.##.######..#.####.#...##.##..##.##.##.#.##.##.#.#...##.#.#..#..#.#..#.#.##.###.###.#...
.#.......#..#.#..#.#..##...##..#.....#.#.##.##...#.#######.#.##.#..#....#.##...#####..###.#.#.#.##..
##.##..#.###...##......#..#.#.#..#...#.#.#...##.###..#.#####..###.##....#..###.......##.#...#..#.###
#.####..#....#...###.#.##.##..#..#..###...#..#.####.##....#.#..#..#.##.##..###.##.##..##.#.#.##.###.
###.#...###...##...##.#..#..#####.#....##.#..##...###..#..##.#.####.##.#..###.##..#.#..##....#..##..
#.####.####.##.#.....###..#.##..##..#....#......##...#...#.###..##.###..#......####.##.#..#.#.##.#..
.......###.#.#.....####.#..####.......##......#.#.#....#####...##..###.....#.#..###..#.####.##.#.###
#..#..#...#..#####..###..#..##.#.#...####..#.#......#.#...##.##..#.##.####..#####.####..#.#..####.##
#..######..#......#..####..##....###.#.##.#.#.#####.#.##.#..##..#.##.####.#.##.#.#.###..###.###...##
...#.#.####.##..##....####..#......###..##...##.#...#.#...#..#.#..##....###.##.#..#####.##..###.#.##
..#####.##..####..#...#...#.###..#..##.#..#.#....#.####.##...#.#####..#.##..#.#######.#..#.##......#
##....##.#.#.#.##...######..##..#.#.##....##.#...###.#..######.#.##..######.##..#...#..#..###..#.##.
.###...###..#####.#......####.......####..#.....##..#.##..#..#####..##.#...#.#...#.###..###....#####
.###.#...#.##.#.##.#.....#..#..#.#####.....####.##..####..#...#.###.#..#.##.#...####..#....#.##...#.
#...##..##.#.##.###.##..#..#.....#..#.###.####.#...#.##.##....#.#.#####.######.#...###.##.#.#.#.#.#.
#.#####...#.#.#####..#.#..#...######...##.##.###.#....#..###.........#.##...#.##...#.##...####....#.
.###.#####..##.##..#.###.....######.######....##..##.#.##.#####..###..###...##.#..##.#..#..........#
....#.#.#.##...#####..###...#..#.####.##..####...####..........#....#.#.#..#...####.##.........#####
####.##..##...#.#.###..#####.....##.#....#.#...#.#####.#####...#.##.##..###.......##.##..##..####.#.
#..#####...##....#.#.#######.#..##..##..##.#..######.###.#.###..##.####.##..#.#.##.##..#.##.#.###.##
#####...#...#.##.##..##.###.##.###..####...##..##..#.#.#.#.#.####.#.#..#.###...#.#........#..###.#..
.###.#..#.##.#.####.#....###..#.#.##.#.....#..#.###..####..###..#.##.#.##.##.....###..#.##...#..#...
.#.#....#.###.#.#...#.#.##..#..#....#####.....###.###..#.####..###.###.#####...#..#.###.#..##.#..##.
.##...#.#....###...###.#.#.##.##.#..###.#.#...#.###.#.#...##..###.##.......#....#..#..#...#..#...###
.###.###.###.##.#.#.#...#.#..#..#.#.#.#.#.#.##.###.##.##..##..#...#.#.####..#.##..##......#...#.#.##
#####.#........#...#####..#.#.####..##.##..##..####.#......##.#.....#..#.###.#..######.#..#.#..#..#.
#...#..####...###.#####..#.#.#..####....#.##..##..#..#.#..###.....#...#.#....##.###.....#...###.###.
...#......#...#.###.#...#....##.....##...###.###.#....##.##.#...##.####.#.##.###.##.###..#.#.###.##.
#####...###.##.##.#..###.#...#..#..#..#...#####.#####..#..#......#.#.######.##.#########..##.###..#.";
        public static void Execute()
        {
            string inp = input3;
            var lines = inp.Split(new[] { '\r', '\n' }, StringSplitOptions.RemoveEmptyEntries);
            BitArray enhancer = GetEnhancer(lines[0]);
            Dictionary<(int x, int y), bool> field = GetField(lines.Skip(1));
            bool unkown = false;
            for (int i = 0; i < 50; i++)
            {
                field = enhance(enhancer, field, unkown);
               unkown = !unkown;
            }
            
            Console.WriteLine(field.Where(f => f.Value).Count());
        }

        private static void PrintField(Dictionary<(int x, int y), bool> field)
        {
            int minx = field.OrderBy(z => z.Key.x).First().Key.x;
            int maxx = field.OrderByDescending(z => z.Key.x).First().Key.x;
            int miny = field.OrderBy(z => z.Key.y).First().Key.y;
            int maxy = field.OrderByDescending(z => z.Key.y).First().Key.y;
            string s = "";
            for (int x = minx; x <= maxx; x++)
            {
                for (int y = miny; y <= maxy; y++)
                {
                  //  s = s + (field[(x,y)] ? "█" :"." );
                    s = s + (field[(x,y)] ? "#" :"." );
                }
                Console.WriteLine(s);
                s ="";
            }
                Console.WriteLine("");
                Console.WriteLine("");
                Console.WriteLine("");
                Console.WriteLine("");
        }

        private static Dictionary<(int x, int y), bool> enhance(BitArray enhancer, Dictionary<(int x, int y), bool> field, bool unknown)
        {
            Dictionary<(int x, int y), bool> newfield = new Dictionary<(int x, int y), bool> ();
            int minx = field.OrderBy(z => z.Key.x).First().Key.x - 1;
            int maxx = field.OrderByDescending(z => z.Key.x).First().Key.x + 1;
            int miny = field.OrderBy(z => z.Key.y).First().Key.y - 1;
            int maxy = field.OrderByDescending(z => z.Key.y).First().Key.y + 1;
            for (int x = minx; x <= maxx; x++)
            {
                for (int y = miny; y <= maxy; y++)
                {
                    BitArray ba = GetSurroundings(field, x, y,unknown);
                    newfield[(x, y)] = enhancer[getIntFromBitArray(ba)];
                }
            }
            return newfield;
        }

        private static BitArray GetSurroundings(Dictionary<(int x, int y), bool> field, int x, int y, bool unknown)
        {
            BitArray ba = new BitArray(9);
            int ind = 8;
            for (int i = x - 1; i <= x + 1; i++)
            {
                for (int j = y - 1; j <= y + 1; j++)
                {
                    if(field.ContainsKey((i,j)))
                    {
                        ba[ind] = field[(i, j)];
                    }
                    else
                    {
                        ba[ind] = unknown;
                    }
                    ind--;
                }
            }
            return ba;
        }

        private static int getIntFromBitArray(BitArray bitArray)
        {

            if (bitArray.Length > 32)
                throw new ArgumentException("Argument length shall be at most 32 bits.");

            int[] array = new int[1];
            bitArray.CopyTo(array, 0);
            return array[0];

        }
        private static Dictionary<(int x, int y), bool> GetField(IEnumerable<string> lines)
        {
            Dictionary<(int x, int y), bool> res = new Dictionary<(int x, int y), bool>();
            int x = 0;
            foreach (var l in lines)
            {
                for (int y = 0; y < l.Length; y++)
                {
                    res.Add((x, y), IsTrue(l[y]));
                }
                x++;
            }
            return res;
        }

        private static BitArray GetEnhancer(string v)
        {
            BitArray res = new BitArray(v.Length);
            for (int i = 0; i < res.Length; i++)
            {
                res[i] = IsTrue(v[i]);
            }
            return res;
        }
        private static bool IsTrue(char c)
        {
            return c == '#';
        }
        private static List<(int, int)> fold(List<(int, int)> points, string direction, int index)
        {
            var res = new List<(int, int)>();
            foreach (var p in points)
            {
                if (direction == "y")
                {
                    if (p.Item1 < index)
                    {
                        res.Add(p);
                    }
                    else
                    {
                        res.Add((index - (p.Item1 - index), p.Item2));
                    }
                }
                else if (direction == "x")
                {
                    if (p.Item2 < index)
                    {
                        res.Add(p);
                    }
                    else
                    {
                        res.Add((p.Item1, index - (p.Item2 - index)));
                    }
                }
                else
                {

                    throw new ArgumentOutOfRangeException("dir");
                }
            }

            return res.Distinct().ToList();
        }

        private static bool[,] fold2(bool[,] data, (string direction, int index) f)
        {
            int mx = data.GetUpperBound(0) + 1;
            int my = data.GetUpperBound(1) + 1;
            if (f.direction == "y")
            {
                mx = f.index - 1;
            }
            else
            {
                my = f.index - 1;
            }
            bool[,] res = new bool[mx, my];
            for (int x = 0; x < mx; x++)
            {
                for (int y = 0; y < my; y++)
                {
                    if (f.direction == "y")
                    {
                        res[x, y] = data[x, y] || data[data.GetUpperBound(0) - x, y];
                        Console.WriteLine($"[x,y] = {x},{y} | {data.GetUpperBound(0) - x},{y}");

                    }
                    else
                    {
                        res[x, y] = data[x, y] || data[x, data.GetUpperBound(1) - y];
                        Console.WriteLine($"[x,y] = {x},{y} | {x},{data.GetUpperBound(1) - y}");
                    }
                }
            }

            return res;
        }

        private static void ProcessData(string[] lines, ref int maxX, ref int maxY, List<(string direction, int index)> folds, List<(int, int)> points)
        {
            foreach (var line in lines)
            {
                var ls = line.Split(',');

                if (ls.Length == 2)
                {
                    int y = int.Parse(ls[0]);
                    int x = int.Parse(ls[1]);
                    maxX = Math.Max(x, maxX);
                    maxY = Math.Max(y, maxY);
                    points.Add((x, y));
                }
                else if (line.Contains("fold along y="))
                {
                    folds.Add(("y", int.Parse(line.Split('=')[1])));
                }
                else if (line.Contains("fold along x="))
                {
                    folds.Add(("x", int.Parse(line.Split('=')[1])));
                }
            }
        }
        private static void ShowDataL(List<(int, int)> points)
        {


            bool[,] data = new bool[points.Select(p => p.Item1).Max() + 1, points.Select(p => p.Item2).Max() + 1];
            foreach (var p in points)
            {
                data[p.Item1, p.Item2] = true;
            }
            ShowData(data);
        }
        private static void ShowData(bool[,] dt)
        {
            int dots = 0;
            StringBuilder disp = new StringBuilder("");
            for (int x = 0; x <= dt.GetUpperBound(0); x++)
            {
                for (int y = 0; y <= dt.GetUpperBound(1); y++)
                {
                    if (dt[x, y])
                    {
                        dots++;
                        disp.Append("X");
                    }
                    else
                    {
                        disp.Append(" ");
                    }
                }
                disp.AppendLine();
            }
            Console.WriteLine(disp);
            Console.WriteLine(dots);
        }

    }
}